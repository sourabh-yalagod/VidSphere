import{i as O,h as T,e as _,c as $,u as B,f as q,j as s,H as z,r as f,b as U,d as Q}from"./index-DLPQuFyB.js";import{C as W}from"./circle-plus-CJDr1wr5.js";import{U as D}from"./user-round-CLXGUVf3.js";import{S as A}from"./Skeleton-BnGMH14x.js";import{V as K}from"./Video-CzMNqvxG.js";import{V as Z}from"./VideoNotFound-BtFNEROq.js";import{A as G}from"./APIError-BWhawoey.js";import{u as J}from"./AddToWatchLater-CZcP3DZ5.js";import{u as X}from"./useMutation-CLAA17dP.js";import{Q as Y,u as ee}from"./useBaseQuery-DC6tQKz4.js";import{L as M}from"./loader-circle-Ct6UWSQg.js";import"./ellipsis-vertical-DC2i2kg6.js";import"./eye-off-BKLs_M59.js";import"./utils-km2FGkQ4.js";var te=class extends Y{constructor(e,r){super(e,r)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(e,r){super.setOptions({...e,behavior:O()},r)}getOptimisticResult(e){return e.behavior=O(),super.getOptimisticResult(e)}fetchNextPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"backward"}}})}createResult(e,r){var b,w;const{state:a}=e,o=super.createResult(e,r),{isFetching:d,isRefetching:l,isError:c,isRefetchError:i}=o,n=(w=(b=a.fetchMeta)==null?void 0:b.fetchMore)==null?void 0:w.direction,p=c&&n==="forward",h=d&&n==="forward",x=c&&n==="backward",v=d&&n==="backward";return{...o,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:T(r,a.data),hasPreviousPage:_(r,a.data),isFetchNextPageError:p,isFetchingNextPage:h,isFetchPreviousPageError:x,isFetchingPreviousPage:v,isRefetchError:i&&!p&&!x,isRefetching:l&&!h&&!v}}};function se(e,r){return ee(e,te)}/**
 * @license lucide-react v0.381.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=$("FileStack",[["path",{d:"M21 7h-3a2 2 0 0 1-2-2V2",key:"9rb54x"}],["path",{d:"M21 6v6.5c0 .8-.7 1.5-1.5 1.5h-7c-.8 0-1.5-.7-1.5-1.5v-9c0-.8.7-1.5 1.5-1.5H17Z",key:"1059l0"}],["path",{d:"M7 8v8.8c0 .3.2.6.4.8.2.2.5.4.8.4H15",key:"16874u"}],["path",{d:"M3 12v8.8c0 .3.2.6.4.8.2.2.5.4.8.4H11",key:"k2ox98"}]]);/**
 * @license lucide-react v0.381.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=$("Music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]),ae=()=>{const e=B(),{userId:r}=q();return s.jsxs("div",{className:"fixed p-1 items-center rounded-t-xl text-white z-10 flex gap-3 justify-around bottom-0 w-full sm:hidden bg-black bg-opacity-50",children:[s.jsxs("div",{onClick:()=>e("/"),className:"grid place-items-center gap-1 text-[9px] hover:scale-110 transition-all cursor-pointer",children:[s.jsx(z,{}),s.jsx("p",{children:"Home"})]}),s.jsxs("div",{className:"grid place-items-center gap-1 text-[9px] hover:scale-110 transition-all cursor-pointer ",children:[s.jsx(ie,{}),s.jsx("p",{children:"Shorts"})]}),s.jsxs("div",{onClick:()=>e("/signin/upload-video"),className:"grid place-items-center gap-1 text-[9px] hover:scale-110 transition-all cursor-pointer",children:[s.jsx(W,{className:"size-8"}),s.jsx("p",{children:"Upload"})]}),s.jsxs("div",{onClick:()=>e(`/signin/subscription-status/${r}`),className:"grid place-items-center gap-1 text-[9px] hover:scale-110 transition-all cursor-pointer",children:[s.jsx(re,{}),s.jsx("p",{children:"subscription"})]}),s.jsxs("div",{onClick:()=>e(`/signin/user-profile/${r}`),className:"grid place-items-center gap-1 text-[9px] hover:scale-110 transition-all cursor-pointer",children:[s.jsx(D,{}),s.jsx("p",{children:"My Profile"})]})]})},ne=[{id:"1",niche:"Sports",value:"sport"},{id:"2",niche:"Movie",value:"movie"},{id:"3",niche:"Politics",value:"politic"},{id:"4",niche:"Economics",value:"economic"},{id:"5",niche:"Songs",value:"song"}],E={Niches:ne};var C=new Map,S=new WeakMap,H=0,ce=void 0;function oe(e){return e?(S.has(e)||(H+=1,S.set(e,H.toString())),S.get(e)):"0"}function le(e){return Object.keys(e).sort().filter(r=>e[r]!==void 0).map(r=>`${r}_${r==="root"?oe(e.root):e[r]}`).toString()}function ue(e){const r=le(e);let a=C.get(r);if(!a){const o=new Map;let d;const l=new IntersectionObserver(c=>{c.forEach(i=>{var n;const p=i.isIntersecting&&d.some(h=>i.intersectionRatio>=h);e.trackVisibility&&typeof i.isVisible>"u"&&(i.isVisible=p),(n=o.get(i.target))==null||n.forEach(h=>{h(p,i)})})},e);d=l.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),a={id:r,observer:l,elements:o},C.set(r,a)}return a}function de(e,r,a={},o=ce){if(typeof window.IntersectionObserver>"u"&&o!==void 0){const n=e.getBoundingClientRect();return r(o,{isIntersecting:o,target:e,intersectionRatio:typeof a.threshold=="number"?a.threshold:0,time:0,boundingClientRect:n,intersectionRect:n,rootBounds:n}),()=>{}}const{id:d,observer:l,elements:c}=ue(a),i=c.get(e)||[];return c.has(e)||c.set(e,i),i.push(r),l.observe(e),function(){i.splice(i.indexOf(r),1),i.length===0&&(c.delete(e),l.unobserve(e)),c.size===0&&(l.disconnect(),C.delete(d))}}function he({threshold:e,delay:r,trackVisibility:a,rootMargin:o,root:d,triggerOnce:l,skip:c,initialInView:i,fallbackInView:n,onChange:p}={}){var h;const[x,v]=f.useState(null),y=f.useRef(),[b,w]=f.useState({inView:!!i,entry:void 0});y.current=p,f.useEffect(()=>{if(c||!x)return;let j;return j=de(x,(m,P)=>{w({inView:m,entry:P}),y.current&&y.current(m,P),P.isIntersecting&&l&&j&&(j(),j=void 0)},{root:d,rootMargin:o,threshold:e,trackVisibility:a,delay:r},n),()=>{j&&j()}},[Array.isArray(e)?e.toString():e,x,d,o,l,c,a,n,r]);const N=(h=b.entry)==null?void 0:h.target,R=f.useRef();!x&&N&&!l&&!c&&R.current!==N&&(R.current=N,w({inView:!!i,entry:void 0}));const g=[v,b.inView,b.entry];return g.ref=g[0],g.inView=g[1],g.entry=g[2],g}const L=5,ge=()=>{var P;B();const[e,r]=f.useState(""),[a,o]=f.useState([]),[d,l]=f.useState(""),{addToWatchLater:c,watchLaterLoading:i}=J(),{toast:n}=U(),{inView:p,ref:h}=he(),x=async({pageParam:t=1})=>{const u=await Q.get(`/api/v1/home?limit=${L}&page=${t}`,{withCredentials:!0});return u==null?void 0:u.data},{data:v,isLoading:y,fetchNextPage:b,isFetchingNextPage:w,hasNextPage:N,error:R}=se({queryKey:["homePageVideos"],queryFn:x,getNextPageParam:(t,u)=>t.length===L?u.length+1:void 0,staleTime:60*30*1e3});f.useEffect(()=>{p&&N&&b()},[p]);const g=(v==null?void 0:v.pages.flatMap(t=>t))||[],m=X({mutationFn:async(t,u)=>{const k=await Q.get(`/api/v1/home/search-video?search=${t||u}`);return k==null?void 0:k.data},onSuccess:t=>{o(t==null?void 0:t.data)},onError:t=>{n({title:"Error while searching...",description:t==null?void 0:t.message,variant:"destructive",duration:1200})}});return y?s.jsx(A,{cards:10}):R?s.jsx(G,{}):s.jsxs("div",{className:"min-h-screen transition-all w-full flex relative place-items-center py-3 dark:bg-black bg-white",children:[s.jsx(ae,{}),s.jsxs("div",{className:"min-h-screen w-full p-2 grid place-items-center transition-all",children:[s.jsxs("div",{className:"w-full grid place-items-center gap-2 md:grid-cols-2",children:[s.jsx("div",{className:"flex w-full max-w-sm overflow-scroll p-1 gap-1 justify-around rounded-xl items-center",children:(P=E==null?void 0:E.Niches)==null?void 0:P.map(t=>s.jsx("p",{className:"bg-white dark:text-white text-black p-2 rounded-xl text-sm sm:text-[16px] cursor-pointer hover:scale-105 transition-all dark:bg-slate-950 hover:dark:bg-slate-800 hover:bg-blue-500 hover:text-white",onClick:()=>{const u=t==null?void 0:t.value;l(u),m.mutate(u)},children:t.niche},t.id))}),s.jsxs("div",{className:"w-full relative max-w-[400px]",children:[s.jsx("input",{type:"text",onChange:t=>r(t.target.value),value:e,placeholder:"Search Here.....",className:"bg-transparent pl-4 py-2 text-gray-700 dark:text-slate-400 grid place-items-center text-[18px] w-full border-gray-700 dark:border-slate-400 outline-none border-[1px] rounded-xl"}),s.jsx("button",{onClick:()=>m.mutate(e),className:"absolute right-0 inset-y-0 cursor-pointer bg-blue-600 text-white px-3 rounded-l-3xl rounded-xl",disabled:m==null?void 0:m.isPending,children:m!=null&&m.isPending?s.jsx(M,{className:"animate-spin"}):"Search"})]})]}),s.jsx("div",{className:"w-full min-h-screen py-5",children:g.length>0?s.jsxs("ul",{className:"grid w-full gap-2 place-items-center sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:[(a.length>0?a:g).map((t,u)=>{var V,I,F;const k=g.length===u+1;return s.jsx("div",{ref:k?h:null,className:"border-slate-700 w-full border p-2 rounded-xl relative max-w-[450px]",children:s.jsx(K,{video:t,userId:(V=t==null?void 0:t.owner)==null?void 0:V._id,username:(I=t==null?void 0:t.owner)==null?void 0:I.username,avatar:(F=t==null?void 0:t.owner)==null?void 0:F.avatar,dropMenuBar:[{name:i?s.jsx(M,{className:"animate-spin"}):"Add to watch Later",operation:()=>c(t==null?void 0:t._id)}]})},t._id+u)}),!(e||d)&&N&&s.jsx(A,{}),w&&s.jsx(M,{className:"animate-spin mx-auto"})]}):s.jsx(Z,{})})]})]})},Me=f.memo(ge);export{Me as default};
